<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashyAds - Watch Ads</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh; overflow: hidden;
        }
        .container {
            max-width: 400px; margin: 0 auto; padding: 20px;
            display: flex; flex-direction: column; height: 100vh;
        }
        .header { text-align: center; color: white; margin-bottom: 30px; }
        .header h1 { font-size: 28px; margin-bottom: 10px; }
        
        /* AD CONTAINER - FULL PAGE */
        #ad-container {
            flex: 1; min-height: 300px; background: rgba(255,255,255,0.95);
            border-radius: 20px; overflow: hidden; position: relative;
        }
        
        /* REWARD POPUP */
        #reward-popup {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: linear-gradient(45deg, #00d4aa, #00b894); 
            border-radius: 25px; padding: 40px 30px; text-align: center; 
            color: white; display: none; z-index: 1000; min-width: 300px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.5);
        }
        .reward-amount { font-size: 42px; font-weight: bold; margin: 15px 0; text-shadow: 0 2px 4px rgba(0,0,0,0.3); }
        .watch-more-btn { 
            background: linear-gradient(45deg, #ff6b6b, #feca57); 
            color: white; border: none; padding: 18px 40px; border-radius: 30px; 
            font-size: 20px; font-weight: bold; cursor: pointer; margin-top: 20px;
            box-shadow: 0 10px 25px rgba(255,107,107,0.4);
            transition: all 0.3s ease;
        }
        .watch-more-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(255,107,107,0.6); }
        
        .loading { text-align: center; padding: 40px; color: white; }
        .spinner { 
            border: 4px solid rgba(255,255,255,0.3); border-top: 4px solid white; 
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; 
            margin: 0 auto 20px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸŽ¬ CashyAds</h1>
            <p>Watch & Earn Instantly!</p>
        </div>
        
        <!-- âœ… YOUR MONETAG AD DIRECTLY EMBEDDED -->
        <div id="ad-container">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>ðŸ”¥ Loading Premium Ad...</p>
                <p style="font-size: 14px; opacity: 0.8;">High CPM Video Ads</p>
            </div>
            
            <!-- YOUR MONETAG SCRIPT - DIRECT INJECT -->
            <div id="monetag-ad">
                <script type="text/javascript">
                    (function(w,d,s,o,f,js,fjs){
                        w[o]=w[o]||function(){(w[o].q=w[o].q||[]).push(arguments)};
                        if(!d.getElementById(f)){
                            js=d.createElement(s); js.id=f;
                            js.src='//libtl.com/sdk.js';
                            js.setAttribute('data-zone','10214030');
                            js.setAttribute('data-sdk','show_10214030');
                            fjs=d.getElementsByTagName(s)[0];
                            fjs.parentNode.insertBefore(js,fjs);
                        }
                    })(window,document,'script','libtl','sdk');
                </script>
            </div>
        </div>
    </div>

    <!-- REWARD POPUP -->
    <div id="reward-popup">
        <h2 style="margin-bottom: 10px;">ðŸŽ‰ AD REWARDED!</h2>
        <div class="reward-amount" id="reward-amount">â‚¹4.25</div>
        <p style="margin-bottom: 20px;">âœ… Successfully watched!</p>
        <button class="watch-more-btn" onclick="watchMoreAds()">ðŸ”¥ WATCH MORE ADS</button>
        <p style="font-size: 14px; margin-top: 15px; opacity: 0.9;">Unlimited Available!</p>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText('Close').show().onClick(() => tg.close());
        
        // YOUR BOT ENDPOINT - UPDATE THIS!
        const BOT_API = 'http://103.138.96.188:8001/cashyads/ad-completed';
        const userId = tg.initDataUnsafe.user ? tg.initDataUnsafe.user.id : 12345;
        
        // Hide loading after 3 seconds or ad loads
        setTimeout(() => {
            document.getElementById('loading').style.display = 'none';
        }, 3000);
        
        let adCount = 0;
        
        // AUTO REWARD AFTER 28 SECONDS (perfect ad timing)
        function startAdTimer() {
            adCount++;
            setTimeout(() => {
                showRewardPopup();
            }, 28000); // 28 seconds = ad + buffer
        }
        
        function showRewardPopup() {
            const reward = (3 + Math.random() * 2).toFixed(2);
            
            // Send to bot
            fetch(BOT_API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    user_id: userId,
                    result: 'completed',
                    reward: parseFloat(reward),
                    ad_count: adCount
                })
            }).catch(() => {}); // Silent fail
            
            document.getElementById('reward-amount').textContent = `â‚¹${reward}`;
            document.getElementById('reward-popup').style.display = 'block';
            tg.HapticFeedback.notificationOccurred('success');
            
            // Auto close after 4 seconds
            setTimeout(() => {
                tg.close();
            }, 4000);
        }
        
        function watchMoreAds() {
            document.getElementById('reward-popup').style.display = 'none';
            
            // Reload ad
            const adContainer = document.getElementById('ad-container');
            adContainer.innerHTML = `
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>ðŸ”¥ Loading Next Ad...</p>
                </div>
                <div id="monetag-ad">
                    <script type="text/javascript">
                        (function(w,d,s,o,f,js,fjs){
                            w[o]=w[o]||function(){(w[o].q=w[o].q||[]).push(arguments)};
                            if(!d.getElementById(f)){
                                js=d.createElement(s); js.id=f;
                                js.src='//libtl.com/sdk.js';
                                js.setAttribute('data-zone','10214030');
                                js.setAttribute('data-sdk','show_10214030');
                                fjs=d.getElementsByTagName(s)[0];
                                fjs.parentNode.insertBefore(js,fjs);
                            }
                        })(window,document,'script','libtl','sdk');
                    </script>
                </div>
            `;
            
            // Start new ad timer
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                startAdTimer();
            }, 2000);
        }
        
        // Start first ad
        startAdTimer();
        
        // Listen for ad load
        window.addEventListener('libtlReady', () => {
            document.getElementById('loading').style.display = 'none';
            console.log('âœ… Monetag ad ready');
        });
    </script>
</body>
</html>
