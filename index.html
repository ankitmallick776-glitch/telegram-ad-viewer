<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CashyAds - Watch Video Ad</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <!-- ‚úÖ YOUR RICHINFO SDK -->
    <script src="https://richinfo.co/richpartners/telegram/js/tg-ob.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            color: white; padding: 20px;
        }
        .container { text-align: center; max-width: 400px; width: 100%; }
        .logo { font-size: 64px; margin-bottom: 20px; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        .title { font-size: 28px; font-weight: bold; margin-bottom: 10px; }
        .subtitle { font-size: 16px; opacity: 0.9; margin-bottom: 30px; }
        .status { font-size: 18px; margin-top: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 12px; backdrop-filter: blur(10px); min-height: 60px; display: flex; align-items: center; justify-content: center; }
        .success { background: rgba(46,213,115,0.3) !important; border: 2px solid #2ed573; }
        .error { background: rgba(255,71,87,0.3) !important; border: 2px solid #ff4757; }
        .progress { width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden; margin-top: 20px; }
        .progress-bar { height: 100%; background: linear-gradient(90deg,#2ed573,#26de81); width: 0%; transition: width 0.3s ease; }
        .btn-ready { background: linear-gradient(45deg, #2ed573, #26de81); color: white; border: none; padding: 15px 30px; border-radius: 25px; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 8px 25px rgba(46,213,115,0.4); margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">üé•</div>
        <div class="title">Premium Video Ads</div>
        <div class="subtitle">Watch 15-30s ‚Üí Earn ‚Çπ3-5 Instantly</div>
        <div class="status" id="status">Loading RichAds Video Network...</div>
        <div class="progress">
            <div class="progress-bar" id="progress"></div>
        </div>
        <button id="watchBtn" class="btn-ready" style="display:none;">‚ñ∂Ô∏è WATCH VIDEO NOW</button>
    </div>

    <script>
        // YOUR VPS ENDPOINT
        const CONFIG = {
            API_URL: 'https://103.138.96.188:8000/cashyads/ad-completed',  // ‚Üê CHANGE THIS
            PUB_ID: "993542",  // YOUR pubId
            APP_ID: "4642"     // YOUR appId
        };
        
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand(); tg.disableVerticalSwipes();
        
        const userId = tg.initDataUnsafe?.user?.id;
        const statusEl = document.getElementById('status');
        const progressEl = document.getElementById('progress');
        const watchBtn = document.getElementById('watchBtn');
        
        function log(message, type = 'info') {
            console.log(message);
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }
        
        function updateProgress(percent) {
            progressEl.style.width = `${percent}%`;
        }
        
        async function notifyBackend(result) {
            if (!userId) return tg.close();
            
            try {
                log('üîÑ Crediting ‚Çπ3-5...', 'info');
                updateProgress(95);
                
                const res = await fetch(CONFIG.API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({
                        user_id: userId,
                        result: result,
                        ad_network: 'richinfo_video',
                        pub_id: CONFIG.PUB_ID
                    })
                });
                
                const data = await res.json();
                log(`‚úÖ +‚Çπ${data.reward || 4}! Balance: ‚Çπ${data.new_balance || '?'}`, 'success');
                updateProgress(100);
                
                tg.HapticFeedback.notificationOccurred('success');
                setTimeout(() => tg.close(), 3500);
            } catch(e) {
                log('‚ùå Payment failed', 'error');
                setTimeout(tg.close, 4000);
            }
        }
        
        // ‚úÖ OFFICIAL VIDEO AD METHOD [web:52]
        let richadsController = null;
        async function initRichAdsVideo() {
            try {
                log('üîÑ Initializing RichAds...', 'info');
                updateProgress(25);
                
                // YOUR SDK
                richadsController = new window.TelegramAdsController();
                await richadsController.initialize({
                    pubId: CONFIG.PUB_ID,  // 993542
                    appId: CONFIG.APP_ID,  // 4642
                    debug: true
                });
                
                log('‚úÖ Video SDK ready!', 'success');
                updateProgress(70);
                
                // Show VIDEO AD button
                watchBtn.style.display = 'block';
                watchBtn.onclick = showVideoAd;
                
            } catch (error) {
                log(`‚ùå SDK Error: ${error.message}`, 'error');
                // Fallback reward
                setTimeout(() => notifyBackend('sdk_error'), 2000);
            }
        }
        
        // ‚úÖ VIDEO ADS - Official method [web:52]
        async function showVideoAd() {
            try {
                log('üé• Loading VIDEO ad...', 'info');
                updateProgress(85);
                watchBtn.style.display = 'none';
                
                // OFFICIAL VIDEO AD TRIGGER
                const result = await richadsController.triggerInterstitialVideo();
                
                log('‚úÖ VIDEO ad completed!', 'success');
                notifyBackend('video_completed');
                
            } catch (error) {
                log('‚ö†Ô∏è Video ad closed', 'info');
                notifyBackend('video_viewed');
            }
        }
        
        // START
        log('üöÄ RichInfo Video Ads', 'info');
        window.addEventListener('load', () => {
            tg.HapticFeedback.impactOccurred('heavy');
            setTimeout(initRichAdsVideo, 1000);
        });
    </script>
</body>
</html>
